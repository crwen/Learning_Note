# 网络层

## ARP 协议

### 工作原理

 数据包到达网络层后，要想将数据发送到链路层需要知道链路层的 MAC 地址。使用 ARP 可以实现有 IP 地址到 MAC 地址的转化。

假设主机 A 知道主机 B 的 IP 地址，A 给 B 发送数据帧的工作流程大致如下：

* 查本地 ARP 缓存，看 ARP 缓存有没有该 IP 地址到 MAC 地址的映射
  * 如果有，直接向 MAC 地址发送信息
  * 如果没有，发送 ARP 广播。主机 B 收到该请求后发送 ARP 响应分组给主机 A。主机 A 将 B 的 IP 地址到 MAC 地址的映射写入 ARP 缓存中。
* 发送数据帧

### ARP 欺骗

 ARP 攻击是利用 ARP 广播来进行的。当一台机器进行 ARP 广播时，攻击者在目标机响应之后（等待一2s）对该请求进行响应，那么目标机器的 IP 到 MAC 地址的映射会被修改。这样，每次源主机发送消息给目标主机发送消息都会发送到攻击者那里。

 攻击者只要使用相同的方法致使源主机与目标主机的 ARP 表篡改，然后自己充当中间人就可以截取这两台主机之间的所有流量了。这种攻击属于中间人攻击。

这种攻击存在两个问题：

* 一台机器在攻击值响应之后进行响应，导致 ARP 缓存修改
* 一段时间，ARP 缓存删除超时记录

攻击方法改进：当收到 ARP 响应时，即使主机没有发送 ARP 请求，也会认为该信息是有效的。因此，可以持续不断地用 ARP 响应攻击主机。



